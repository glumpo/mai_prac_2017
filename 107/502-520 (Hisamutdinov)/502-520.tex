
		\begin{equation}
		p^2\equiv1(mod 2^q) \;\text{и}\; \alpha\rho\equiv-1 (mod\;2^q) \Rightarrow \alpha\rho\equiv-p^2 (mod\;2^q)
		\end{equation}
		Можно сократить последнее сравнение на р (р нечетно, а следовательно, обратимо по модулю $2^q$) и получится, что $a+p \equiv0$ (mod $2^q$). Теперь имеем неравенства $ap<2^q\leqslant a+p$, а это приводит к $(a-1)p \leqslant a -1$, что возможно лишь при a=1, т.е. $p=2^q-1$

	\paragraph{Другое доказательство следствия 73}
	\noindent
	
	Второе доказательство не использует структуру кольца $\mathbb Z[\sqrt{3}]$, а	происходит в кольце $A =\mathbb Z[\sqrt{3}] /(M_q).$ Обозначим через $\alpha$ и $\beta$ соответственно образы элементов $2+\sqrt{3} и 2-\sqrt{3}$ в A. Сравнения \\
	\begin{equation}
	(2+\sqrt{3})^{2^{q-1}} \equiv (mod\;M_q) \Rightarrow (2+\sqrt{3})^{2^q} \equiv 1 (mod\;M_q)
	\end{equation}
	показывают, что $\alpha$ имеет порядок $2^q$ в A. Существенно отметить, что последний вывод сделан благодаря неравенству $1\neq-1$ в A  (2 обрати­
	мо в А, так как $M_q$ нечётно) Итак, 2 остается обратимым в любом частном Л и, в частности, $\alpha$  имеет порядок $2^q$ не только в А, но и в любом его частном: это замечание является основным для дальнейшего	доказательства.
	
	Пусть р — некоторый простой делитель $M_q$.Покажем, что р непременно равно $M_q$, что и докажет простоту $M_q$. Этот делитель необратим	в A (поскольку является делителем нуля в A). Пусть М  — максималь­
	ный идеал А, содержащий р. Тогда факторкольцо А/М является полем	характеристики р (так как $p \in$ M ) и
	следовательно, имеет подполе $\mathbb F_p = \mathbb Z/p \mathbb Z$.
	
	Коэффициенты многочлена $(X-\bar\alpha)(X-\bar\beta)$ принадлежат $\mathbb F_p$, так как  $\alpha+\beta = 4$ и $\alpha\beta=1$. Поскольку $\bar\alpha$ - корень этого многочлена, то таковым является и $\bar\alpha^p$ (из-за формального равенства $P(X)^p = P(X^p)$ в $\mathbb Z/p \mathbb Z[X]$ Следовательно, в А /М имеем:
	

	\begin{center}
		$\bar{\alpha}^p = \bar{\alpha}$ или 
		$\bar{\alpha}=\bar{\beta}=\bar{\alpha}^{-1}=\bar{\alpha}^{2^q-1}$
	\end{center}
	 Используя то, что $\bar{\alpha}$ имеет порядок $2^q$ в  $(A/M)^{*}$, получаем:
	 
	 \begin{center}
	 	$p\equiv (mod \; 2^q)$ или $ p\equiv2^q-1 (mod \; 2^q)$
	 \end{center}
     Поскольку $p$ делит $2^q-1 = M_q$, то $p<2^q$, что делает невозможным левое сравнение. Из правого сравнения следует, что $p\geqslant 2^q-1$, а значит, $p=2^q-1$, что и требовалось доказать.
     
     \pagebreak
     
     
     
     \paragraph{Из простоты $M_q$  следует сравнение Лукаса — Лемера} 
     
     \noindent 
     
     При доказательстве этой импликации используется частный случай закона квадратичной взаимности Лежандра — Гаусса. Для простого  числа $p$ и $a \in \mathbb Z - p\mathbb Z$ символ Лежандра  $(\frac{a}{p})$ равен 1, если $а$ является
     квадратом по модулю $p$ и равен —1 в противном случае. Для числа 3  закон квадратичной взаимности можно записать следующим образом:
     
     \begin{lemma}
     \noindent
     
     Пусть $р$ — простое число, отличное от 2 и 3. Число 3 является ква дратичным вычетом по модулю $р$ тогда и только тогда, когда $р$ $\equiv$ ±1
     (mod 12).
     \end{lemma}
     \begin{myproof}
     \noindent
     
 	 
 	 	
 	 	Закон квадратичной взаимности, примененный к числу 3, дает  $(\frac{3}{p})(\frac{p}{3}) = (-1)^{(p-1)/2}$.Следовательно, 3 является квадратичным вычетом по модулю $р$ тогда и только тогда, когда $(\frac{p}{3}) = (-1)^{(p-1)/2}$ Единственным квадратом по модулю 3 является 1, откуда $p \equiv 1 \;(mod \; 3)$ и $p \equiv 1 \;(mod \; 4)$, либо $p \equiv 2 \;(mod \; 3)$ и $p \equiv 3 \;(mod \; 4)$ Отсюда следует искомый результат.
	 \end{myproof}
 
 	 \begin{sled}
 	 \noindent
 	 
 	 Пусть $M_q = 2^q - 1$ — простое число Мерсенна с показателем $q$, большим или равным 3. Тогда $(2+\sqrt{3})^{2^{q-1}} \equiv -1 \; (mod\;M_q)$.
 	 \end{sled}
 	 \begin{myproof}
 	 \noindent
 	 
 	 
 	 	
 	 	Для удобства записи положим $p = M_q$. Поскольку $p \equiv 7 \; (mod\;12)$ (см. доказательство следствия 73), то из предыдущего доказательства следует, что 3 не является квадратом по модулю $р$, а потому 
 	 	\begin{equation}
 	 	\sqrt{3}^p = 3^{(p-1)/2}\sqrt{3}\equiv -\sqrt{3} \;(mod;\ p)
 	 	\end{equation}
 	 	
 	 	\begin{center}
 	 		откуда $(x+y\sqrt{3})^p \equiv x- y\sqrt{3} (mod;\ p)$
 	 	\end{center}
  	    Это сравнение можно рассматривать как малую теорему Ферма в $\mathbb Z[\sqrt{3}]$. С другой стороны, 2 является квадратом по модулю $р$. Можно, конечно, вспомнить теорему о квадратичной взаимности, а можно получить это в явном виде:

 	 	\begin{equation}
 	 		\begin{split}
 	 			2(2^q-1) \equiv (mod ;\ 2^q-1) & \Rightarrow  2^{q+1} \equiv 2 (mod \; p) \\ 	
 	 			& \Rightarrow (2^{(q+1)/2})^2 \equiv 2 (mod \; p)
 	 		\end{split}
 	 	\end{equation}

 	 	Определим теперь два элемента $\tau$ и $\bar{\tau}$ в $\mathbb Z[\sqrt{3}]/(p)$ как $\tau = \dfrac{1+\sqrt{3}}{\sqrt{2}}$ и
 	 
 	 
 	 \pagebreak 
  	 
  	 
  	 	$\bar\tau = \frac{1-\sqrt{3}}{\sqrt{2}}$. Элементарные вычисления дают:
		\begin{center}
			$\tau^2 = 2 +\sqrt{3}$ в $\mathbb Z[\sqrt{3}]/(p), \tau\bar{\tau}=-1$
		\end{center}
		
		Из сравнения (4) выводим:
		\begin{equation}
		\begin{split}
		\tau^p=\bar{\tau} & \Rightarrow\bar{\tau}^{p+1}=-1 (\text{так как} \tau\bar{\tau}=-1) \\ &
		\Rightarrow (2+\sqrt{3})^{(p+1)/2} \equiv (mod\;p) (\text{так как} \tau^2 = 2+\sqrt{3}) \\ &		
		\Rightarrow (2+\sqrt{3})^{2^{q-1}} \equiv -1 (mod\;p).
		\end{split} 
		\end{equation}
  	 \end{myproof}	
   
   \noindent
   
   Приведем обычную формулировку теоремы Лукаса — Лемера, кото рая хотя и является переформулировкой теоремы 71, но не использует больше $\sqrt{3}$.
   
   \begin{thm}[тест Лукаса — Лемера]
   \noindent
   
   Пусть $M_q = 2^q-1$  — число Мерсенна с нечетным показателем $q$,  большим или равным 3. Поставим ему в соответствие следующую по­следовательность Лукаса — Лемера 
   $(L_i)_{i\geqslant 0}:$
   
   \begin{center}
   	$L_0=4$ и $L_{i+1} = L_{i}^{2}-2\;mod\;M_q$ 
   \end{center}
	Число $M_q$ простое тогда и только тогда, когда $L_{q-2}\equiv 0\;(mod\;M_q)$
	\end{thm}
	\begin{myproof}
	\noindent
	
		Положим $\omega=2+\sqrt{3},\bar{\omega}=2-\sqrt{3}$. Используя то, что $\omega\bar{\omega}=1$, и индукцию по $i$, легко показать, что $L_i = \omega^{2^{i}} + \bar{\omega}^{2^{i}}$. Теперь также легко проверяется эквивалентность для некоторого целого числа $n$:
		\begin{equation}
		L_i\equiv0\;(mod\;n) \Longleftrightarrow \omega^{2^{i+1}} \equiv -1\;(mod\;n)
		\end{equation}
		Действительно, во всяком кольце, если выполнено равенство $yz = 1$,	то эквивалентны равенства $y+z = 0$ и $y^2 = -1$. Осталось применить	эти рассуждения к $y=\omega^{2^{i}}$ и $z=\bar{\omega}^{2^{i}}$
  	\end{myproof}
  
  	\subsection{Тест на простоту Рабина — Миллера}
  	
  	\noindent
  	
  	Если $р$ — простое число, то малая теорема Ферма утверждает, что $b^{p-1} \equiv 1 \;(mod\;p)$ для любого $Ь$, не кратного $р$ (т.е. взаимно простого с $р$). Этот критерий можно использовать для того, чтобы показать, что некоторое число $n$ — $\it составное$. Выберем целое число
  	$1<b<n-1$ и 
  	
  	\pagebreak
  	
  	
  	\noindent
  	вычислим $b^{n-1} mod\;n$ при помощи дихотомии. Если последний результат отличен от 1, то $n$ — составное, в противном случае ничего конкретного сказать нельзя. На практике бывает полезно перед вычислением $b^{n-1}\;mod\;n$, требующем $log(n— 1)$ операций, вычислить НОД$(b,\;n)$,что требует $\varTheta(logb)$ операций, и в случае результата, отличного от 1,
  	сразу доказывать, что $n$ составное. Например, для приведенного ниже $n$ вычисление $З^{n-1}- 1 mod\;n$ требует 128 возведений в квадрат по модулю $n$:
  	\begin{center}
  		$n=2^{2^{7}}+1=34\; 282 \;366 920\; 938\; 463\; 463\; 374\; 607\; 431\;768 211\;457$,
  		
  		$3^{n-1}\;mod\;n=47\; 511\;664\;169 \;441\;434\; 718\; 291\;075\; 092 \;691\;853 \;899.$
  	\end{center}
  	\noindent
  	Последнее доказывает, что $n$ непростое (вопросы: что дает вычисление НОД$(3,n)$? а если выбрать основание $b = 2$ вместо $b = 3?$). Конечно,  это несерьезный пример, поскольку $n$ не что иное как число Ферма  $F_7$, непростота которого может быть установлена при помощи теста  Пепина, который утверждает, что число Ферма $F_q=2^{2^{q}}+1$ простое  тогда и только тогда, когда $3^{\frac{F_q-1}{2}}\equiv —1\;(mod\;F_q)$ (см.упражнение 23).
  	\begin{determ}
  	\noindent
  	
  	Число $n \in \mathbb N^{*}$ {\bf называется псевдопросты}  по основанию $b \in \mathbb N^{*}$ ,	если $b^{n-1} \equiv 1\;(mod\;n)$ (что, в свою очередь, приводит к тому, что $b$ и $n$ — взаимно просты).
  	\end{determ}
  	\paragraph{{\it Пример псевдопростого числа}}
  	\noindent
  	
  	Пусть $n=105 = 3\times5\times7$ . Число $n$ не является псевдопростым по основанию 2, поскольку $2^104 = 2^{17\times6+2}= (2^6)^{17} \times 2^2 \equiv 4\;(mod\;7)$
  	и, тем более, $2^{104} \not\equiv 1 (mod\;105)$. Однако, $n$ является псевдопростым по основанию 13:
  	\begin{equation}
  	13^{104}=(13^2)^{52}\equiv 1\;(3), 13^104=(13^4)^{26} \equiv 1\;(5),
  	\end{equation}
  	\begin{equation}
  	 13^{104} = (13^6)^{17}\times 13^2 \equiv \;(7)
  	\end{equation}

  	
  	и, следовательно, $13^{104} \equiv 1\;(mod\;105)$
  	
  	\noindent
  	
	Является ли простым целое число $n$, псевдопростое по любому основанию $b$, взаимно простому с $n$? Ответ неизвестен.

  	

  	
	\begin{determ}
  	
	\noindent
  	

  	
	Число $n$ называется числом Кармайкла, если оно псевдопростое
	по любому основанию $b$, взаимно простому с $n$ (по-другому, если
  	

  	
	\pagebreak
  	
  	 \noindent
  	 $x^{n-1} = 1$ в группе $U(\mathbb Z_n)$ (обратимых по модулю $n$ элементов), но само при этом {\bf простым не является}. 
  	\end{determ}
  	Классический пример: $n = 561 = 3 \times 11 \times 17$. Группа $U(\mathbb Z_{561})$ изоморфна произведению трех групп $U(\mathbb Z_3)$, $U(\mathbb Z_{11})$, $U(\mathbb Z_{17})$ порядков 2, 10	и 16 соответственно.Но $n — 1 = 560$ делится на каждое чисел 2, 10, 16, а потому $х^{560} = 1$ в группе $U(\mathbb Z_{561})$ и число 561 является псевдопростым,	но не простым (это наименьшее число Кармайкла).

  	
  	\paragraph{(79) Напоминания} (см. раздел 3.3).
  	\noindent
  	
  	({\it i}) Индикатором Кармайкла $\lambda(n)$ целого числа $n$ называется экспонента группы $U(\mathbb Z_{n})$, т.е. наименьшее целое число $m$ такое, что $x^m = 1$.	Наименьшее как но отношению к упорядочению $\leqslant$ так и по делимости:$\lambda(n)$ делит всякое такое число $m$.
  	
  	({\it ii}) Индикатор Кармайкла $\lambda(n)$ делит значение функции Эйлера 	$\varphi(n)$ и вычисляется следующим образом:
  	\begin{itemize}
  		\item если $n_1,n_2,...,n_r$— взаимно простые числа, то $\lambda(n_1n_2...n_r)=$ \\ НОК$(\lambda(n_1)\lambda(n_2)...\lambda(n_r))$,
  		\item если $р$ — простое число, отличное от 2, то $\lambda(p^{\alpha}) = р^{\alpha-1}(р — 1)$,
  		\item $\lambda(2)=1,\lambda(4)=2$ и $\lambda(2^{\alpha})=2^{\alpha-2}$ при $\alpha \geqslant 3$
  	\end{itemize}
  
  	({\it iii}) Целое непростое число $n$ является числом Кармайкла тогда и  	только тогда, когда индикатор Кармайкла $\lambda(n)$ делит $n — 1$.
  	\paragraph{{\it Сильно псевдопростые числа}} 
  	\noindent
  	
  	Существование чисел Кармайкла доказывает, что выполнение свой­ства $b^{n-1} \equiv 1 (mod \;n)$ для всякого $b$, взаимно простого с $n$, недостаточно для выяснения простоты $n$. Чтобы усилить это свойство, заметим,что если $n$ — нечетное простое число, то, кроме сравнения $b^{n-1}\equiv1\;(mod\;n)$,	 выполняется сравнение $b^{\frac{n-1}{2}}\equiv\pm 1 \;(mod\;n)$ (поскольку в поле $у^2=1 \Rightarrow у = \pm 1$). Далее, если $b^{n-1}\equiv1\;(mod\;n)$ и $\dfrac{n-1}{2}$ четно, то $Ь^{\frac{n-1}{4}} \equiv \pm 1\;(mod\;n)$... Получаем:
  	
  	\begin{determ} 
  	\noindent

  	Пусть $n$ — целое {\bf нечетное} число и $n — 1 = 2^kq$, где $q$ — нечетное.	Назовем число $n$ {\bf сильно псевдопростым} по основанию $b \in \mathbb Z$, если	выполняются следующие условия:
  	
  	\begin{center}
  		$b^q\equiv1 \; (mod\;n)$ или $\exists\;j\;\in [0,k-1],\; b^{2^{j}q}\equiv-1\;(mod\;n)$
  	\end{center}
  	\end{determ}
  
  	\begin{predl} 
  	\noindent

  	Пусть $n$ — целое нечетное число. Если $n$ — простое, то $n$ — сильно псевдопростое по любому основанию $b, 1 \eqslantless6<n$. Если $bn$ — сильно 
  
  	\pagebreak 
  	
  	\noindent
  	псевдопростое по основанию $b$, то оно псевдопростое по основанию $b$ (в частности, взаимно простое с $Ь$).
	\end{predl}
  	
  	\begin{myproof} 
  	\noindent
  	
  	
  		Пусть $n — 1 = 2^kq$ с нечетным $q$. Для доказательства первого пункта рассмотрим наименьшее целое число $i \in [0, k]$ с $b^{2^{i}q} \equiv 1\;(mod\;n)$ ($k$ удовлетворяет этому свойству). Если $i = 0$, то $b^q \equiv 1\;(mod\;n)$. Если	$i > 0$, то для $j = i — 1$ выполняется $0 \leqslant j < к$ и $b^{2^{i}q} \equiv 1\;(mod\;n)$.	Для доказательства второй части заметим, что в любом случае существует такое $i \in [0, k]$, что $b^{2^{i}q} \equiv 1\;(mod\;n)$ (возвести в квадрат
  		сравнение $b^{2^{i}q} \pm 1\;(mod\;n)$ и заметить, что $j < k$). Так как $2^{i}q$ делит $n — 1$, то $b^{n-1} \equiv 1\;(mod \;n)$.

  		
  	\end{myproof}	
  	
  	\paragraph{{\it Пример числа Кармайкла}}
  	\noindent
  	
  	Число $n = 561 = 3 \times 11 \times 17$ является числом Кармайкла, а потому 	псевдопростое по основанию 2. Однако оно не является сильно псевдо-простым по основанию 2. Действительно, $n — 1 = 35 \times 2^4$
  	и $2^{35\times 2} \equiv1\;(mod\;561)$, а $2^{35\times 2^2} \equiv 67\;(mod\;561)$.
  	
  	\begin{lstlisting}[mathescape=true, caption=Сильная псевдопростота по основанию $b$]
  	c $\longleftarrow$$b^q$ % n
  	if(c == 1|| c == n-1){
  	return n  есть $\;$ псевдопростое $\;$ по $\;$ основанию $\;$ b;
  	} 
  	j$\longleftarrow$ 0;
  	while(j != k-1){ \\ $c=b^{2^{i}}$ )(mod n) и j<k \\
  		c $\longleftarrow$ c^2 % n;
  		j $\longleftarrow$ j+1;
  		if(c == n-1)
  			return n псевдопростое $\;$ по $\;$ основанию $\;$ b;
  		if(c == 1)	break;
  	}	
  	return n  не $\;$сильно $\;$ псевдопростое $\;$ по $\;$ основанию$ \;$ b;
  	 
  	\end{lstlisting}
  	В алгоритме 7 реализуется концепция сильной псевдопростоты.	Входными параметрами этого алгоритма являются основание $b$ и це­лое число $n \geqslant 3$ с $n - 1 = 2^kq$, где $q$ нечетно. Отметим выход из цикла	{\bf exit when} $с = 1$:действительно, если $b^{2^{j}q} \;mod\;n = 1$, то $b^{2^{j^{'}}q}\;mod\;n = 1$	для любого $j' \geqslant j$, а потому $n$ не является сильно псевдопростым по основанию $b$. 
  	
  	Целые числа  $\leqslant 25 • 10^9$, сильно псевдопростые по малым основаниям 	были изучены Померанцем, Селфриджем и Вагстафом [148]. Существует лишь 13 не простых сильно псевдопростых чисел по основаниям 2,
  	
  	\pagebreak
  	
  	
  	\noindent
  	3, 5 и нет ни одного не простого сильно псевдопростого числа по основаниям 2, 3, 5, 7 и 11.
  	
  	\subsection{Вероятностный алгоритм Рабина}
  	
  	\begin{thm}[Рабин]
  	\noindent
  	
  	Пусть дано целое {\bf нечетное} число $n$. Определим
  	\begin{center}
  		$B_n = $\{$x\;\in\;U(\mathbb Z_n)\;|\;n$ сильно псевдопростое {\bf по основанию} $x$\} 
  	\end{center}
  	Если $n$-{\bf непростое} (а значит, $\geqslant$ 9), то отношение числа элементов множества $B_n$
  	к числу элементов $U(\mathbb Z_n)$ не превосходит $\dfrac{1}{4}$, т.е $\dfrac{|B_n|}{\varphi(n)} \leqslant \dfrac{1}{4}$. Исключение составляет случай $n = 9$.
  	\end{thm}
  	Можно придать вероятностную окраску приведенной выше формулировке, рассматривая вероятность $р_n = \dfrac{|B_n|}{\varphi(n)}$ того, что $n$ сильно псевдопростое по основанию из $U(\mathbb Z_n)$. Теорема Рабина утверждает, что 	если $n$ {\bf непростое}, то эта вероятность не превосходит 1/4. Когда $n$  	непростое, можно рассматривать элементы $B_n$	как «свидетелей» простоты в том смысле, что они наводят на мысль о простоте $n$. Следовательно, если число $n$ является сильно псевдопростым по $m$ случайно 	выбранным основаниям, то с вероятностью ошибки, меньшей, чем $\dfrac{1}{4^m}$ можно считать, что $n$ — простое. Другая формулировка теоремы Рабина — следующее следствие, в котором надо исключить $n = 9$ как непростое число.

  	
  	\begin{sled}
  	\noindent
  	
  	Если нечетное целое число $n$ сильно псевдопростое по основанию $b$	для любого $b \in B\subset U(\mathbb Z_n)$ и $|B| \geqslant \dfrac{\varphi{n}}{4}$, то $n$  — простое.
  	\end{sled}
  	Теорема Рабина приводит к следующему вероятностному алгорит­му. Зафиксируем множество $В$ оснований тестов на сильную псевдопростоту и будем проверять по этим основаниям нечетное целое число $n$, строго большее каждого $b \in В$, до тех пор, пока не выполнится одно из следующих условий; $n$ не сильно псевдопростое по основанию $b$, а  	потому составное; $n$ — сильно псевдопростое по любому из используе­мых оснований и с вероятностью ошибки, меньшей, чем $\leqslant\dfrac{1}{4^{|B|}}$, можно считать, что $n$ — простое.

  	
  	\paragraph{{\it Пример реализации}}
  	\noindent
  	
  	Приведем описание реализации теста Рабина в системе формальных 	вычислений Scratchpad. Устраним сначала некоторое количество целых чисел $n$ (например,$\leqslant 100 ООО$), относительно которых можно точно
  	
  	\pagebreak
  	\noindent
  	выяснить, простые они или нет. Для этого возьмем первые 66 простых  	чисел $p_i$, выпишем их ($р^{2}_{65}< 100 000 < р^{2}_{66}$) и начнем алгоритм с деления 	$n$ на эти числа:
  	\begin{center}
  		
  		2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, \\
  		73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 127, 131, 137, 139,149, \\  		
  		151, 157, 163, 167, 173, 179, 181, 191,193,197, 199, 211, 223, 227, \\ 229, 233, 239, 241,251, 257, 263, 269, 271, 277, 281, 283, 293, 307, \\	311, 313, 317.
  	\end{center}	
  
  	Если $n$ не делится ни на одно из $p_i$, то применим тест Рабина, зафиксировав в качестве оснований первые 10 простых чисел $В = { 2, 3, 5, 7, 11, 13, 17, 19, 23, 29 }$. Результат работы теста «вероятно, число $n$ — простое» будет верным с вероятностью $ \geqslant 1 — \frac{1}{4^{10}} \approx	0,99999905.$
 
 	\begin{tabular}{|c|l|}
 		\hline
 		1 195 068 768 795 265 792 518 361 315 725 116 351 898 245 581 = \\ 24 444 516 448 431 392 447 461 $\times$ 48 889 032 896 862 784 894 921 \\
 		\hline
 		1 345 587 387 292 051 697 387 186 550 543 937 646 682 206 242 741 = \\ 845 101 010 021 569 864 697 461 $\times$ 1 690 202 020 043 139 729 394 921 \\
 		\hline
 		8 218 776122 312 414 589 259 453 815 284 880 194 791 556 136 781 = \\ 2 027 162 564 067 373 284 085 861 $\times$ 4 054 325 128 134 746 568 171 721 \\
 		\hline
 		21 725 013 656 018 763 076 105 459 253 647 137 482 758 798 581 781 = \\ 3 295 831735 390 837 809 700 861 $\times$ 6 591 663 470 781 675 619 401 721 \\ 
 		\hline 
 		65 133 961 998 738 965 332 758 869 580 009 452 514 988 654 652 701 = \\ 5 706 748 724 043 269 339 010 901 $\times$ 11 413 497 448 086 538 678 021 801 \\ 
 		\hline
 		19 840 288 923 887 081 357 309 700 907 668 002 023 719 213 638 581 = \\ 3 149 626 082 877 702 592 298 461 $\times$ 6 299 252 165 755 405 184 596 921 \\ 
 		\hline
 		47 824 338 726 623 806 233 423 439 382 232 910 557 660 981 544 141 = \\ 4 890 007 092 358 036 970 775 781 $\times$ 9 780 014 184 716 073 941 551 561 \\ 
 		\hline
 		40 731 291916 337 435 991 504 960 386 523 783 671925 548 224 861 = \\ 4 512 831 257 444 567 691 328 021 $\times$ 9 025 662 514 889 135 382 656 041 \\ 
 		\hline
 		65 670 822 302 684 064 701 133 181 659 108 281 791 806 006 666 541 = \\ 5 730 219 118 964 128 438 904 581 $\times$ 11 460 438 237 928 256 877 809 161 \\ 
 		\hline
 		111 968 231 758 836 883 865 259 414 369 643 926 962 293 874 583 421 = \\ 7 482 253 395 830 593 088 122 741 $\times$ 14 964 506 791 661 186 176 245 481 \\
 		\hline
	\end{tabular}
	\begin{center}
		{\bf Таблица 6.} Сильно псевдопростые числа по основаниям 2, 3, . . . , 29
	\end{center}

	В таблице 6 дан список чисел (найденных Ф. Арнаутом), которые	объявлены системой Scratchpad простыми, а сами таковыми не явля­ются.
	
	\pagebreak
	
	\subsection{Доказательство теоремы Рабина}
	\noindent
	
	В доказательстве перечисляются элементы множества $B_n$. Используя китайскую теорему об остатках, можно пересчитать решения урав­нения $х^q= \pm 1$ в циклической группе $U(\mathbb Z_{p_{i}^{\alpha_{i}}})$.

	
	\begin{lemma}
		
				
		($i$) В конечной мультипликативной группе $G$ уравнения $x^q= 1$ и $x^{\text{НОД}(q,|G|)}  = 1$ эквивалентны.

		
		($ii$) Если $G$ — циклическая группа, то $Н = \{x \in G | x^q = 1\}$ —
		циклическая подгруппа порядка НОД($q, |G|$).
		
	\end{lemma}	

	\begin{myproof}
		Если $x^q = 1$, то $x^{uq+v|G|} = 1$ для любых $u,v \in \mathbb Z$, откуда $x^{\text{НОД}(q,|G|)}  = 1$ Обратное утверждение очевидно. Для доказатель­ства пункта (ii) рассмотрим образующий $g$ группы $G$ Нетрудно проверить, что $h = g^{\frac{|G|}{\text{\small{НОД}}(q,|G|)}}$ является образующим подгруппы $H$ порядка НОД($q,|G|$).
	\end{myproof}	

	\begin{lemma}
		
		Элемент у циклической группы $G$ является $q$-й степенью тогда и только тогда, когда $y^{\frac{|G|}{\text{\small{НОД}}(q,|G|)}} = 1$ В этом случае число решений уравнения  $x^q = y$ равно НОД($q,|G|$)
	\end{lemma}

	\begin{myproof}
		Подгруппа $G^{(q)}$ группы $G$, состоящая из $g-х$ степеней, изоморфна факторгруппе $G/\{x \in G,x^q = 1\}$, а потому ее порядок равен 
		$\frac{|G|}{\text{\small{НОД}}(q,|G|)}$. Эта. подгруппа содержится в подгруппе $H = \{y\in G | y^{\frac{|G|}{\text{\small{НОД}}(q,|G|)}} = 1\}$ такого же порядка и, следовательно $G^{(q)} = H$. Вторая часть леммы доказывается легко. Допустим мы	хотим в явном виде представить элемент $y \in H$ как $g$-ю степень. Запишем $y = g^m$, где $g$ - образующий группы $G$. $\frac{m|G|}{\text{\small{НОД}}(q,|G|)}$ кратность $|G|$, а значит, $m$ делится на НОД($q,|G|$), т.е. существуют такие $u,v \in \mathbb Z$, что $m=uq+v|G|$ и $y=g^m = g^{uq}g^{v|G|} = x^q$ с $x=g^u$
	\end{myproof}	
	
	Вычисления, которые приведены ниже, несколько утомительны. Начнем с частного случая чисел $n$, для которых $\frac{|B_n|}{\varphi(n)} = \frac{1}{4}$ . Этот частный случай не только иллюстрирует используемую технику, но и то,
	насколько тщательным должно быть общее доказательство для того, чтобы получить границу $\frac{1}{4}$.
	
	\pagebreak
	
	\noindent
	
	\paragraph{{\it Пример предельного случая}}
	\noindent 
	
	Рассмотрим простое число $p_1 \equiv 3\;(mod\;4)$ такое, что число $р_2=2p_1 — 1$ также является простым (например, $p_1 = 40039, 41011, 42727$).	Тогда $n = p_1p_2$ —составное и $\frac{|B_n|}{\varphi(n)} = \frac{1}{4}$ (числа такого вида появятся в общем доказательстве). Запишем $p_1 = l+2q_1$, $р_2 = l+4q_1$ с нечетным $q_1$.	Для вычисления $|В_n|$ положим $n — 1 = 2^k q$, где $q$ — нечетное:

	
	\begin{equation}	
	\begin{split}
	n=(q+2q_1)(1+4q_1)=1+8q_{1}^2 + 6q_1 & \Rightarrow n-1=2q_1(3+4q_1) \\ & \Rightarrow k = 1, q=q_1(3+4q_1),
	\end{split}
	\end{equation}
	и воспользуемся тем, что множество $В_n$ есть объединение двух непересекающихся множеств $Р_n$ и $Q_n$:
	
	\begin{equation}
	P_n=\{x \in U(\mathbb {Z}_n) | x^q=1 \}, \;\;\; Q_n= \{x \in U(\mathbb {Z}_n) | x^q=-1 \}.
	\end{equation}
	По китайской теореме об остатках $|P_n|=|P_{p_{1}}| \times |P_{p_{2}}|$ и $Q_n| = |Q_{p_{1}}| \times |Q_{p_{2}}|$   (обозначения понятны). $|P_{p_{i}}|$
	 вычисляются по лемме 84:
	 
	\begin{equation}
	|P_{p_{1}}| = \text{НОД}(q,p_1-1) = \text{НОД}(q,2q_1) = \text{НОД}(q,q_1)=q_1, \\ 
	|P_{p_{2}}|= \text{НОД}(q,p_2-1) = \text{НОД}(q,4q_1) = q_1,
	\end{equation}
	а $|Q_{p_{i}}|$ вычисляются по лемме 85, поскольку $(-1)^{\frac{p_i-1}{\text{НОД}(q,p_i-1)}}=1$:
	\begin{equation}
	|Q_{p_{1}}| = \text{НОД}(q,p_1-1)=q_1, \;\;\; |Q_{p_{2}}| = \text{НОД}(q,p_2-1)=q_1
	\end{equation}
	Итак,$|B_n| = q_{1}^2 + q_{1}^2 = 2q_{1}^2$, а $\varphi(n) = (p_1-1)(p_2-1) = 8q_{1}^2$, откуда
	следует, что $\frac{|B_n|}{\varphi(n)} = \frac{1}{4}$
	
	\begin{lemma}
	\noindent
	
	Пусть $n = p_{1}^{\alpha_{1}}p_{2}^{\alpha_{2}} ...p_{r}^{\alpha_{r}}$ 	— разложение нечетного числа $n$ на про­стые множители. Положим $n = 1 + 2^kq$ с нечетным $q$ и для любого $i$ $p_i = 1 + 2^{k_{i}}q_i$, где все $q_i$ также нечетны. Если $k_1 \leqslant	k_2 \leqslant ...	k_r$	(чего
	можно добиться, переставив $p_i$), то

	\end{lemma}	

	\begin{equation}
		|B_n| = \text{НОД}(q,q_1)\text{НОД}(q,q_2)...\text{НОД}(q,q_r)(1+\sum_{0\leqslant j \leqslant < k_1} 2^{jr}).
	\end{equation}
	
	\begin{myproof}
	В дальнейшем неоднократно будет использоваться равенство: 
	\begin{equation}
	\text{НОД}(2^jq,\varphi(p_{i}^{\alpha_i}))=2^{\inf(j,k_i)}\text{НОД}(q,q_i)
	\end{equation}
	
	
	
	\noindent
	Действительно, $p_i$ делит $n$ и потому взаимно просто с $n — 1 = 2^kq$,а значит, и с $2^j$	. Отсюда
	
	\begin{equation}
	\begin{split}
	\text{НОД}(2^jq,\varphi(p_{i}^{\alpha_i-1}(p_i-1))) & = \text{НОД}(2^jq,p_{i} = \\ & = \text{НОД}(2^jq,2^{k_{i}}q_i = 2^{\inf(j,k_i)}\text{НОД}(q,q_i)
	\end{split}
	\end{equation}
	Множество $B_n$	является объединением непересекающихся множеств $P_n = Q_n(j)(0 \leqslant j<k)$, где:
	
	\begin{equation}
	P_n = \{x \in U(\mathbb Z_n) | x^q= 1 \}, \; Q_n(j) = \{x \in U(\mathbb Z_n) | x^{2^{j}q}= -1 \},
	\end{equation}
	а потому
	\begin{equation}
	|B_n| = |P_N|+\sum_{0\leqslant j \leqslant < k} |Q_N(j|)
	\end{equation}
	1. Вычислим $|Р_n|$: при понятных обозначениях из китайской теоре	мы об остатках следует изоморфизм $Р_n \simeq P_{p{1}^{\alpha_1}} \times P_{p{2}^{\alpha_2}} \times ... \times P_{p{r}^{\alpha_R}}$,
	приводящий к тому, ЧТО $|Р_n| = |Р_{p^{\alpha_{1}}_1}| \times |Р_{p^{\alpha_{2}}_2}| \times ... \times |Р_{p^{\alpha_{r}}_r}|$ . Применяя
	лемму 84 к  циклической группе $U(\mathbb Z_{p_{i}^{\alpha_i}}$, получим:

	
	\begin{equation}
	|Р_{p^{\alpha_{i}}_i}|=\text{НОД}(q,\varphi(p_{i}^{\alpha_{i}})) = \text{НОД}(q,q_i).
	\end{equation}
	\noindent
	Следовательно
	
	\begin{equation}
	|P_n| = \text{НОД}(q,q_1) \times \text{НОД}(q,q_2) \times ... \times \text{НОД}(q,q_r).
	\end{equation}
	2. Вычислим $|Q_n(j)|$:аналогично, китайская теорема об остатках устанавливает биекцию между множествами $Q_n(j)$ и $Q_{p_{1}^{\alpha_1}}(j) \times
	Q_{p_{2}^{\alpha_2}}(j) \times ... \times Q_{p_{r}^{\alpha_r}}(j),$ а потому $|Q_n(j)| = |Q_{p_{1}^{\alpha_1}}(j)| \times			|Q_{p_{2}^{\alpha_2}}(j)| \times ... \times |Q_{p_{r}^{\alpha_r}}(j)|$ По лемме 85,
	\begin{equation}
	\begin{split}
	|Q_{p_{i}^{\alpha_i}}(j)| \neq 0  & \Longleftrightarrow (-1)^{\frac{\varphi(p_{i}^{\alpha_i})}{\text{НОД}(2^jq,\varphi(p_{i}^{\alpha_i})}} = 1 \\  & \Longleftrightarrow \frac{2^{k_i}q_i}{2^{\inf(j,k_i)}\text{НОД}(q,q_i)};\ \text{четно}
	\end{split}
	\end{equation}
	Поэтому $|Q_{p_{i}^{\alpha_i}}(j)| \neq 0$ тогда и только тогда, когда $j < k_i$. В этом случае, опять же по лемме 85,
	\begin{equation}
		|Q_{p_{i}^{\alpha_i}}(j)| = \text{НОД}(2^{j}q,\varphi(p_{i}^{\alpha_i})) = 2^j \text{НОД}(q,q_i). 
	\end{equation}	
	Так как $k_1 \leqslant k_2 \leqslant ... \leqslant k_r$, то для данного $j$ имеем:
	
	\pagebreak
	
	\begin{equation}	
	\begin{split}
	& \text{если} j \geqslant k_1, то |Q_j(j)|=0 \\
	& \text{если} j<k_q, то |Q\_j(j)|= 2^{jr}\text{НОД}(q,q_1)...\text{НОД}(q,q_r)
	\end{split}
	\end{equation}
	Заметим, что $k_1 \leqslant k,$ ибо $p_i\equiv 1\;(mod\;2^{k_1})$, а значит, $n\equiv 1\; (mod\;2^{k_1})$. Следовательно, сумма из (5) равна
	
	\begin{equation}
	\sum_{0\leqslant j<k}|Q_n(j)| = \sum_{0\leqslant j<k_1}|Q_n(j)| = \\ = \text{НОД}(q,q_1)\text{НОД}(q,q_2)...\text{НОД}(q,q_r) \sum_{0\leqslant j<k_1} 2^{jr}
	\end{equation}
	Заключение леммы следует из равенств (5), (6), (7).
	
 	\end{myproof}
	Проиллюстрируетм вычисление $B_n$ на примере числа Кармайкла \\
	
	$n = 561 = 3 \times 11 \times 17$. Имеем:
	
	\begin{center}
		
		$561 - 1 = 2^4 \cdot 35,~k = 4, q = 35,~~~~ 3 - 1 = 2^1 \cdot 1,~k_1 = 1,~q_1 = 1,$
		
		$11 - 1 = 2^1 \cdot 5,~k_2 = 1,~q_2 = 5,~~~ 17 - 1 = 2^4 \cdot 5,~k_3 = 1,~q_3 = 1$
		
	\end{center}
	
	что дает
	
	$$|P_{561}| = \text{НОД}(q, q_1)~\text{НОД}(q, q_2)~\text{НОД}(q, q_3) = 5,$$
	
	$$|Q_{561}(0)| = \text{НОД}(q, q_1)~\text{НОД}(q, q_2)~\text{НОД}(q, q_3) \sum_{0 \leqslant j < 0} 2^{3j} = 5$$
	
	\noindent и $|B_{561}| = 10.$. Значит, существует 8 числел (кроме 1 и -1), которые являются "свидетелями простоты" числа 561, в то время как это число простым не является. Отношение $\frac{|B_{561}|}{\varphi(561)} = \frac{1}{32} \approx 0, 03125$ довольно небольшое.
	
	\begin{lemma}
		
		\hspace*{0,5cm}
		
		\textit{В обозначениях предыдущей леммы имеет место следующая оценка:}
		
		\begin{center}
			
			$\frac{|B_n|}{\varphi(n)} \leqslant \frac{1 + \frac{2^{k_1r} -1}{2^{r} - 1}}{2^{k_1r}} \times K,$ где $ K = \prod_{i=1}^{r} \frac{\text{НОД}(q, q_i)}{q_i} \times \prod_{i=1}^{r} \frac{1}{Pi^{a_i-1}},$
			
		\end{center}
		
		Кроме того, если \textit{не все $k_i$ равны между собой}, то
		
		$$\frac{|B_n|}{\varphi(n)} \leqslant \frac{1~+~\frac{2^{k_1r}~-~1}{2^{r}~-~1}}{2^{k_1r~+1}} \times K.$$
		
	\end{lemma}
	
	\pagebreak
	\noindent
	\begin{myproof}
		Имеем:
		\begin{equation}
		\begin{split}
		\varphi(n) & = (p_1-1)p_{1}^{\alpha_1-1}(p_1-1)p_{1}^{\alpha_1-1}... (p_r-1)p_{r}^{\alpha_r-1} = \\ & = 2^{k_1+k_2+...+k_r}q_1p_{1}^{\alpha_1-1}q_2p_{2}^{\alpha_2-1}...q_rp_{r}^{\alpha_r-1} 
		\end{split}
		\end{equation}
		откуда
		\begin{equation}
		\begin{split}
		\frac{|B_n|}{\varphi(n)} & = \frac{1+ \sum_{0\leqslant_{j <k_1}} 2^{jr}}{2^{k_1+k_2+...+k_r}} \times \frac{\text{НОД}(q,q_1)}{q_1p_{1}^{\alpha_1-1}}\frac{\text{НОД}(q,q_2)}{q_2p_{2}^{\alpha_2-1}}...\frac{\text{НОД}(q,q_r)}{q_rp_{r}^{\alpha_r-1}} \\ & = \frac{1+\frac{2^{k_1r-1}}{2^r-1}}{2^{k_1+k_2+...+k_r}} \times K		
		\end{split}
		\end{equation}
		Если заменить $2^{k_1+k_2+...+k_r}$ на $2^{rk_1}$ то получим первое неравенство.
		Если, кроме того, не все $k_i$, равны $k_1$, то, заменяя $2^{k_1+k_2+...+k_r}$ на$2^{rk_1+1}$, получим второе неравенство.		
	\end{myproof}	

	\paragraph{Доказательство теоремы 82 в случае, когда $n$ — степень простого числа (г = 1).}
	
	
	Пусть $n = p_{1}^{\alpha_1}$с $\alpha_1 \geqslant 2$ (так как $n$ — непростое). Применяя предыдущую лемму ($г = 1$), получим:
	\begin{equation}
	\frac{|B_n|}{\varphi(n)} \leqslant \frac{\text{НОД}(q,q_1)}{q_1} \times \frac{1}{p_{1}^{\alpha_1-1}} \leqslant \frac{1}{p_{1}^{\alpha_1-1}},
	\end{equation}

	откуда при $p_1\geqslant 5$ находим $\frac{|B_n|}{\varphi}(n) \leqslant \frac{1}{5}$. При $р_1= 3 \frac{|B_n|}{\varphi(n)} \leqslant \frac{1}{9}$, за ис­ключением случая$\alpha_1= 2$, т.е. $n = 9: B_9	= {1, — 1}$, $\varphi(9) = 6$, а значит,$\frac{|B_9}{\varphi(9)} = \frac{1}{3}$
	
	\paragraph{Доказательство теоремы 82 в случае, когда пстепеней простых чисел $(r \geqslant 2)$.}
	
	\noindent
	
	Выражение $\frac{1+\frac{2^{k_1r}-1}{2^r-1}}{2^{k_1}r}$, которое использовалось при оценке $\frac{B_n|}{\varphi(n)}$ (в предыдущей лемме), убывает при возрастании $k_1$ (достаточно расписать
	$\frac{1+\frac{2^{k_1r}-1}{2^r-1}-\frac{1}{2^r-1}}{2^{k_1}r} = \frac{1-\frac{1}{2^r-1}}{2^{k_1}r} + \frac{1}{2^r-1}$). Поэтому можно оценить $\frac{B_n|}{\varphi(n)}$, заменив $k_1$ на 1:
	\begin{equation}
	\frac{B_n|}{\varphi(n)} \leqslant \frac{1}{2^{r-1}}\prod^{r}_{i=1} \frac{\text{НОД}(q,q_i)}{q_i} \times \prod^{r}_{i=1} \frac{1}{p_{i}^{\alpha_i-1}} \leqslant \frac{1}{2^{r-1}} \times \prod^{r}_{i=1} \frac{1}{p_{i}^{\alpha_i-1}}.
	\end{equation} 
	

	\pagebreak
	\noindent
	Если хотя бы одно из $а_i$ больше или равно 2, то $\Pi^{r}_{i=1}\frac{1}{p_{i}^{\alpha_i-1}} \leqslant \frac{1}{3}$ и 
	\begin{equation}
	\frac{|B_n|}{\varphi(n)}\leqslant \frac{1}{2} \times \frac{1}{3} = \frac{1}{6}
	\end{equation}	
	Поэтому в дальнейшем можно считать, что все $а_i$ равны 1 и число $n$ —
	произведение $r \geqslant 2$ различных простых чисел.
	\begin{beznomera}[Случай]
	$r \geqslant 3$ Из предыдущих неравенств получаем: 
	\begin{equation}
	\frac{|B_n|}{\varphi(n)} \leqslant 
	\begin{cases}
	1/8, \text{если}\;r\geqslant 4, \\ 
	1/4, \text{если}\;r = 4.
	\end{cases}
	\end{equation}	
	Равенство $\frac{|B_n|}{\varphi(n)} = \frac{1}{4}$ достигается тогда и только тогда, когда $r = 3, k_1=k_2=k_3=1$ и $q_i|q$. Иначе говоря, если разложение $n$ на простые числа есть $n=(1+2q_1)(1+q_2)(1=2q_3)$.
	
	\end{beznomera}

	\begin{beznomera}[Случай]
			$r = 2$ и $k_1<k_2.$ Используя второе неравенство предыдущей леммы, аналогично получаем, что выражение $\frac{1+ \frac{2^{k_{1^r}}-1}{2^r-1}}{2^{k_{1^r}=1}}$ убывает	при возрастании $k_1$ и можно заменить $k_1$ на 1:
			\begin{equation}
			\frac{|B_n|}{\varphi(n)} \leqslant \frac{1}{2^2}\prod^{2}_{i=1} \frac{\text{НОД}(q,q_i)}{q_i} \leqslant \frac{1}{2^2}
			\end{equation}
	Равенство 	$\frac{|B_n|}{\varphi(n)} = \frac{1}{4}$ получается тогда и только тогда, когда $k_1=1, k_2=k_1 +1 = 2,q_1\;|q,q_2\;|\;q,$ что приводит к $q_1=q_2,$ и разложение $n$ на	простые множители есть $n=(1+2q_1)(1+4q_1)$
	\end{beznomera}	

	\begin{beznomera}[Случай]
		$r=2$ и $_1 = k_2$. Имеем неравенство 
		
		\begin{equation}
		\frac{|B_n|}{\varphi(n)} \leqslant \frac{1}{2}\prod^{2}_{i=1} \frac{\text{НОД}(q,q_i)}{q_i}
		\end{equation}
		Покажем, что одновременно не может выполняться $q_1 | q$и $q_2|q$. Действительно, поскольку 
		\begin{equation}
		2^kq=n-1=p_1p_2-1=(1+2^{k_{1}}q_2)-1=2^{k_1}(q_1+q_2)+2^{2k-1}q_1q_2,
		\end{equation}
	
		то соотношение $q-1|q$ приводит к тому, что  $q_1|q_2$, а соотношение $q_2|q$ к $q_2|q_1$. Поэтому $q_1=q_2$,а следовательно, $p_1=p_2$ что невозможно. \\	Значит,
		\begin{equation}
		\text{либо} \frac{\text{НОД}(q,q_1)]}{q_1} \leqslant \frac{1}{3}, \text{либо} \frac{\text{НОД}(q,q_2)]}{q_2} \leqslant \frac{1}{3}, \Rightarrow \frac{|B_n|}{\varphi(n)} \leqslant \frac{1}{2} \times \frac{1}{3} = \frac{1}{6}.
		\end{equation}
		
	\end{beznomera}	

	Во всех рассмотренных случаях $\frac{|B_n|}{\varphi(n)} \leqslant \frac{1}{4}$,причем общий вид чисел, на	которых достигается равенство, известен.
	
	\pagebreak
	
	\subsection{Ро-метод Полларда факторизации чисел}
	\noindent
	Для поиска некоторого множителя целого числа $n$ $\rho$-метод Поллар­да использует следующую идею. Поставим в соответствие многочле ну $f \in \mathbb Z[X]$ и числу $y_0 \in \mathbb Z$ последовательность $у_{i+1} = f(y_i)$ $mod\;n$
	элементов из $\mathbb Z_n$ с первым членом $у_0$ $mod\;n$. Предположим, что пара ( $f\;mod \;n,\;у_0\;mod\;n$) обладает случайным свойством. По аналогии с алгоритмом Брента (см. раздел 4.3) образуем пары ($y_h,y_k$), заменяя тест	$y_h=y_k$
	некоторым другим тестом, который будет описан ниже.
	
	Так как $n$ предполагается составным, то у него должен быть про­стой множитель $р < \sqrt{n}$, пока неизвестный. Этому простому $p$ можно	поставить в соответствие последовательность $x_{i+1} = f(x_i)$ $mod\;p$ с первым членом $x_0 = у_0$ $mod\;p$, которая тоже еще не известна. Алгоритм	Брента, виртуально примененный к этой последовательности, дает пару таких индексов ($h,\;k$), что $x_h= х_k$
	и можно считать, что $k$ порядка	$\sqrt{p}$ (это выполняется, если пара ( $f\;mod\;р, х_0 = у_0\;mod\;p$) выбрана случайным образом). Но $x_i = y_i\;mod\;р$ для всякого $i$, а следовательно,
	
	\begin{equation}
		x-h=x_k  \Rightarrow p|y_h-y_k \Rightarrow p|\text{НОД}(y_h-y_k,n).
	\end{equation}

	
	\begin{lstlisting}[mathescape=true,caption=Неоптимизированный $\rho$-метод Полларда]
	j$\leftarrow$1;y$\leftarrow$ $y_0$ % n;
	int main(){
	y'$\leftarrow$ y;
	for($\lambda = 1$; $\lambda$<j;++$\lambda$){
		y$\leftarrow$ f(y) % n; d $\leftarrow$ НОД(|y-y'|,n);
		if(d>1){break}
		}
		j$\leftarrow$ 2j;
	}
	\end{lstlisting}
	
	При реализации тест на {\bf вычислимость} последовательности $y_i$ состоит в том, чтобы определить, будет ли $d = \text{НОД}(|y_h -y_k|, n)$ строго	больше 1. Если это так, то с большой вероятностью d является нетривиальным делителем $n$: действительно, если $d$ — делитель $n$, строго
	больший 1, то он равен $n$ тогда и только тогда, когда $y_h=y_k$. Последнее равенство, в силу случайности выбора пары ( $f\;mod\;n, у_0\;mod\;n$), означает, что $k$ — число порядка $\sqrt{n}$. С другой стороны, $к$ порядка
	$\sqrt{p}\leqslant \sqrt[4]{n} \ll \sqrt{n}$ и, скорее всего, $у_h \neq y_k$.
	
	Алгоритм 8, реализующий $\rho$-метод Полларда, после окончания своей работы выдает делитель $d$ числа $п$, который больше 1. Если этот
	
	\pagebreak
	\noindent
	делитель $< n$, то он не тривиален, и число $n$ можно факторизовать; в противном случае алгоритм терпит неудачу (выдавая $d = n$). 
	
	Этот алгоритм предполагает существование многочлена $f(X)$ , который можно рассматривать как случайную функцию из $\mathbb Z_p$ в $\mathbb Z_p$ (а так­же из $\mathbb Z_p$ в  $\mathbb Z_p$ для простых делителей $< \sqrt{n}$). В настоящее время не­известно, как выбрать такой многочлен. Однако, эксперимент показал, что многочлены вида $X^2+a$, и в частности $X^2+ 1$, по-видимому, обла­дают необходимыми случайными свойствами. Именно эти многочлены	используются обычно в реализациях.
	
	Обсуждаемый алгоритм требует большого количества вычислений	НОД и, чтобы улучшить его эффективность, Поллард предлагает вместо того, чтобы вычислять НОД на каждом этапе, накопить произве­дение $\pi$ по модулю $n$ из $s$ последовательных значений $у — у'$. Число $s$	должно быть меньше, чем простые множители $n$ (например, $s = 10$ или $s = 100$, при этом следует проверить, не являются ли маленькие простые	числа делителями $n$). После $s$ итераций проверяется неравенство d =	НОД($\pi,n$)
	\noindent
	$> 1$: если оно верно, то $d$ является либо нетривиальным делителем $n$ (алгоритм удался), либо $d = n$. Во втором случае следует вернуться на­зад и поискать в последнем произведении $\pi$ первый такой множитель,	что $d = \text{НОД}(|y — y'|, n) > 1$. Опять, если $d < n$, то алгоритм удался, в	противном случае — не удался.
	
	При применении этого метода полезно изменить значения пар ($h, k$),	использовавшиеся в методе Брента, следующим образом:	
	
	\begin{table}[h!]
		\centering
		\label{my-label}
		\begin{tabular}{|c|c|c|c|c|}
			$k$ & 0            & $2s$             & $6s$                & $(2^i-2)s$                         \\ \hline
			$k$ & $s+1,...,2s$ & $4s + 1,.. , 6s$ & $10s + 1 ,..., 14s$ & $h + 2^{ i-1}s + 1 ,..., h + 2^is$
		\end{tabular}
	\end{table}

	Есть несколько замечаний относительно выбора пар ($h, k$). Во-первых, длина интервала значений $к$, соответствующих $h = (2^i — 2)s$, равна	$2^{i-1}s$, а потому удваивается на каждом этапе (каждый этап состоит	из $s$ итераций). Во-вторых, последнее значение $к$ равно следующему	значению $h$. Наконец, в-третьих, $k — h$ пробегает все значения, большие  или равные $s + 1$ и, следовательно, пара ($h,k$) с $х_h, = x_k$ наверняка	найдется.
	
	Последняя деталь, касающаяся реализации алгоритма 9, в котором	явно не фигурируют переменные $h$и $k$. Последовательные значения пе­ременной $j$ связаны с последующими значениями переменной $h$: если	$j = 2^{i-1}$ , то $h = (2^i — 2)s$ и $у = y_h$- Если теперь осуществить $2^{i-1}s$ итераций $у \leftarrow f(y)$, то получим $у = y_{k^{'}-1}$, где $к'$ — первый элемент ин-
	
	\pagebreak
	\noindent
	тервала значений $к$. Снова осуществляя $2^{i-1}s$ присваиваний $у \leftarrow f(y)$ (группами по $s$ присваиваний), получим $у = у_{k^{''}}$, и $k"$ обозначает уже	последний элемент интервала значений $к$.

	
	\begin{lstlisting}[mathescape=true,caption=Оптимизированный $\rho$-метод Полларда]
	$y\leftarrow y_0$ % n ; $j\leftarrow 1$;
	int main(){
	y'$\leftarrow$y;
	for(int l = 1;l <= s*j; l++){$y\leftarrow f(y)$;}
	for(int l = 1;  <= j; l++){
		$y_{sabed} \leftarrow y; \pi \leftarrow 1$;
		for(int e = 1; e <= s; e++){
			$y\leftarrow f(y); \pi \leftarrow \pi(y-y')$ % ;		
			}
		$d \leftarrow \text{НОД}(pi,n);$
		if(d>1){break;}		
		}
	$ j \leftarrow 2j$;	
	}
	if(d == n){ $y\leftarrow y_{saved}$
		while(d <= 1){
		$y\leftarrow f(y); d \leftarrow \text{НОД}(|y-y'|,n)$;
		}
	}
	
	\end{lstlisting}
	
	\paragraph{{\it Примеры}}
	\noindent
	
	Приведем два примера, в которых используется случайный много	член $f(X )= X^2 + 5$  и первый член последовательности $у_0 = 1$.
	
	1. Для $n$ = 100 003 300 009 ($\approx 10^{11}$) при помощи метода Полларда	находится делитель $р$ = 100 0003 ($\approx 10^6$). Разложение $n$ на простые	множители есть $n = pq$ с $q =$ 100 003 ($\approx 10^5$). Приведем значения $\mu$ и $\lambda$	для последовательностей $x_{k+1} =  f(x_k)$ $mod$ $p$ и $x_{k=1} = f(x_k)$ $mod$ $q$:

	
	\begin{equation}
	\text{для} p: \mu = 63, \lambda_p=22, \;\;\; \text{для} q:\mu-q=199, \lambda_q = 54.
	\end{equation}
	
	\noindent
	Неравенство $\lambda_p	< \lambda_q$ объясняет, почему метод Полларда находит дели­тель $р$, хотя $р > q$.

	
	2. Метод Полларда (с параметрами, приведенными выше) терпит	неудачу с числом $n$ = 10 097 063, являющимся произведением двух простых чисел $р =$ 1009 и $q =$ 10 007. Рассмотрим три последовательности:
	
	\begin{equation}
	u_0 =1, u_{k+1} = (u_{k}^2+5)\;mod\;p, \;\; v_0 = 1, v_{k=1} = (v_{k}^2 + 5)\;mod\;q, \\ y_0=1,\;y_{k+1} = (y_{k}^2 + 5)\; mod \; n.
	\end{equation}
	
	\pagebreak
	Последовательности $u$ и $v$ имеют одну и ту же длину периода $\lambda = 47$	(а потому ту же длину периода имеет последовательность $у$). Параметр $\mu$ последовательности $х$ равен 52 ($u_{52} = u_{52+47} = 678$), а последователь­	ности $у — 61$ ($u_{61} = u_{61+47} = 8392$). Следовательно, если два индекса	$h, к с h < к$ удовлетворяют неравенству НОД$(n, |y-y_h) > 1$, то $k — h$	кратно $\mu$. Как только $h$ становится больше 61, то сразу $y_k = у_h$, что и	объясняет, почему метод Полларда в данном случае терпит неудачу.
	
	\section{Это только начало}
	\epigraph{. . . В математических журналах формулы и теоремы, как правило, пронумерованы. Эти числа обычно не превышают 1000.	Следовательно, легко, на первый взгляд определить теорему по ее номеру. Но, если взять очень толстый журнал, мы можем на­ткнуться на теорему номер 157 767 733 443 477. Где-то дальше в	этом журнале мы могли бы прочитать \guillemotleft ... таким образом, при­меняя теорему 157 767 733 443 477 , имеем ...\guillemotright и мы вынуждены	были бы сравнивать эти числа цифра за цифрой, чтобы проверить, что речь идет об одном и том же числе, и даже использовать карандаш, отмечая галочкой каждую цифру, чтобы избежать их повторения. 
	} {Alan Turing, On computable num bers... (1940 [87])}

	Эта глава заканчивается, а мы лишь слегка коснулись сути предмета. Мы изложили классические, т.е. элементарные, методы. Но наука	идет вперед. Те, кто открывают большие простые числа, всегда исполь­
	зуют алгоритмы, аналогичные алгоритму Полларда, для умножения целых чисел, однако используемые компьютеры становятся все мощнее и	могут работать параллельно. Следовательно, в алгоритме Полларда все
	три преобразования Фурье могут вычисляться одновременно...
	
	Надежность криптографических систем тесно связана с невозмож­ностью факторизации больших чисел. Мы изложили лишь один метод факторизации, далеко не единственный и не лучший. К классическим относят метод, основанный на разложении в цепную дробь числа $\sqrt{n}$;$(р — 1)$-метод Полларда, который основан на разложении числа $р — 1$ на малые простые для некоторого делителя р числа п; метод квадратичного решета: образуются небольшие квадратичные вычеты по модулю $n$,	которые факторизуются (каким-либо иным методом), а затем, комбинируя их различными способами, можно пытаться получить сравнения	типа $x^2\equiv y^2$ $(mod\;n)$. Но методы, которые дают сейчас наилучшие
	
	\pagebreak
	
	результаты, используют эллиптические кривые. Эти же самые кривые	используются как основа криптографических систем, и мы снова возвращаемся к началу этого параграфа. Мы не знаем, какова сложность	проблемы факторизации целых чисел, а потому мы ничего не знаем о	надежности RSA.
	
	Начиная с теста Рабина — Миллера, тесты на простоту также	претерпели существенные улучшения. Тест Рабина — Миллера хотя и	очень быстрый, но имеет один серьезный недостаток: он не дает гаран­
	тий простоты исследуемых чисел. Но существуют детерминированные	тесты. Один из таких критериев был найден Адлеманом, Померанцем и	Рамели, а впоследствии упрощен и улучшен Коэном и Ленстрой [50]. По­лученный алгоритм может быть применен к числам, о которых метод	Рабина — Миллера говорит, что они, вероятно, простые, для полно­го доказательства их простоты. Недавно эллиптические кривые стали	использоваться и в области исследований на простоту. Как видим, за­трагиваемые в этой главе темы далеки от завершения.

